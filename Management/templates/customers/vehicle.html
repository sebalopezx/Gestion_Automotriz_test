{% extends 'base_customer.html' %}

{% block header %}
    <h1>Vehículos</h1>
{% endblock header %}

{% block content %}

{% comment %} <ul>
    {% if list_vehicle %}
        {% for vehicle in list_vehicle %}
            <li>{{ vehicle }}</li> {% endcomment %}

                {% comment %} {% for date in appointment %}
                    {% if date.vehicle_id == vehicle.id %}
                        {% if date.inprogress %}
                            <button>
                                <a href="{% url 'state_vehicle' date.id %}">
                                    ID Cita:({{ date.id }}) Estado Vehículo
                                </a>
                            </button>
                        {% else %}
                            <button disabled>
                                ID Cita:({{ date.id }}) Vehículo en espera            
                            </button>
                        {% endif %}
                    {% endif %}
                {% endfor %} {% endcomment %}

                {% comment %} {% for job in list_job %}
                    {% if job.appoitment_id.vehicle_id == vehicle.id and job.id %}
                        {% if job.appoitment_id.inprogress %}
                            <button>
                                <a href="{% url 'state_vehicle' job.appoitment_id.id %}">
                                    ID Cita:({{ job.appoitment_id.id }}) Estado Vehículo
                                </a>
                            </button>
                        {% else %}
                            <button disabled>
                                ID Cita:({{ job.appoitment_id.id }}) Vehículo en espera            
                            </button>
                        {% endif %}
                    {% endif %}
                {% endfor %}

            <br>
            <form action="{% url 'delete_vehicle' vehicle.id %}" method="POST">
                {% csrf_token %}
                <button>
                    Eliminar Vehículo
                </button>
            </form>
        {% endfor %}    
    {% else %}
        <li>{{ error }}</li>
    {% endif %}
</ul> {% endcomment %}



    <!-- Identificar si existen vehiculos -->
    {% if list_vehicle %}
        {% for vehicle in list_vehicle %}
        <div class="card text-center">
            <div class="card-header">
                {% comment %} {{ vehicle }} {% endcomment %}
                {{ vehicle.brand|capfirst }} 
                {{ vehicle.model|capfirst }} 
                Patente: {{ vehicle.patent }}
            </div>
            <div class="card-body">
                <h5 class="card-title"><i>Estado de citas del vehículo</i></h5>
          
     
            <!-- appointment_set permite accedes a las relaciones del vhiculo con las citas -->
                {% for appointment in vehicle.appointment_set.all %}
                    {% if appointment.inprogress and appointment.job_set.all %}
                        <button class="btn btn-sm btn-primary">
                            <a href="{% url 'state_vehicle' appointment.id %}">
                                ID Cita:({{ appointment.id }}) Estado
                            </a>
                        </button>
                    {% elif appointment.inprogress and not appointment.job_set.all %}
                        <button class="btn btn-sm btn-outline-danger">
                            ID Cita:({{ appointment.id }}) Eliminada            
                        </button>
                    {% else %}
                        <button class="btn btn-sm btn-outline-primary" disabled>
                            ID Cita:({{ appointment.id }}) En espera            
                        </button>
                    {% endif %}
                {% endfor %}
                <br>
                <form action="{% url 'delete_vehicle' vehicle.id %}" method="POST">
                    {% csrf_token %}
                    <button class="btn btn-sm btn-danger mt-3">
                        Eliminar Vehículo
                    </button>
                </form>
            </div>
        </div>
        {% endfor %}
<ul>
    {% else %}
        <li class="list-group-item list-group-item-warning mb-5">{{ error }}</li>
    {% endif %}
</ul>

<div class="mx-auto text-center mt-5">
    <button class="btn btn-primary mt-3">
        <a href="{% url 'register_vehicle' %}">Registrar nuevo Vehículo</a>
    </button>
    <button class="btn btn-primary mt-3">
        <a href="{% url 'register_date' %}">Registrar nueva Cita</a>
    </button>
 </div>


{% endblock content %}